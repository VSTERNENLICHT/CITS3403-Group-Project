<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CalcMyWAM</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      margin: 0;
      padding: 0;
      height: 100vh;
    }

    .sidebar {
      width: 200px;
      background-color: #f4f4f4;
      border-right: 1px solid #ccc;
      padding: 20px;
      box-sizing: border-box;
    }

    .sidebar h3 {
      margin-top: 0;
    }

    .tab-button {
      display: block;
      width: 100%;
      padding: 8px;
      margin-bottom: 5px;
      text-align: left;
      cursor: pointer;
      background-color: #e0e0e0;
      border: none;
      border-radius: 4px;
    }

    .tab-button.active {
      background-color: #d0d0ff;
      font-weight: bold;
    }

    .main {
      flex: 1;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 {
      margin-top: 0;
    }

    .tab-name-editor input {
      width: 100%;
      padding: 6px;
      font-size: 1rem;
    }

    .form-container {
    width: 100%;
    display: none;
    flex-direction: column;
    align-items: center;
    }

    .form-container.active {
    display: flex;
    }

    .tab-name-editor {
    margin-bottom: 15px;
    width: 30%; 
    }

    .form-section {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    flex-wrap: nowrap; /* force items to stay on one line */
    width: 100%;
    overflow-x: auto;
    position: relative;
    }

    .form-section label {
      display: flex;
      flex-direction: column;
      font-size: 0.9rem;
      align-items: center;
      text-align: center;
    }

    select, input[type="number"], input[type="checkbox"] {
      padding: 4px;
      width: 120px;
    }

    .remove-section {
      position: absolute;
      top: 5px;
      right: 10px;
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: red;
    }

    .button-row {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    button {
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h3>Categories</h3>
    <div id="tabs"></div>
    <button onclick="addTab()">+ Add Tab</button>
  </div>

  <div class="main">
    <h2>CalcMyWAM</h2>

    <div class="tab-name-editor">
      <input type="text" id="tabNameInput" placeholder="Tab Name" oninput="renameTab(this.value)">
    </div>

    <div id="contentArea">
      <!-- Dynamic tab content will go here -->
    </div>

    <div class="button-row">
      <button onclick="addFormSection()">Add New Section</button>
      <button onclick="submitData()">Submit</button>
    </div>
  </div>

  <script>
    let tabCount = 0;
    let activeTabId = null;
    const tabs = {};

    function addTab() {
      const tabId = `tab${tabCount++}`;
      tabs[tabId] = [];

      const tabButton = document.createElement('button');
      tabButton.className = 'tab-button';
      tabButton.textContent = `Tab ${tabCount}`;
      tabButton.onclick = () => switchTab(tabId);
      tabButton.dataset.tabId = tabId;

      document.getElementById('tabs').appendChild(tabButton);

      const tabContent = document.createElement('div');
      tabContent.className = 'form-container';
      tabContent.id = tabId;

      document.getElementById('contentArea').appendChild(tabContent);

      switchTab(tabId);
    }

    function switchTab(tabId) {
      activeTabId = tabId;

      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tabId === tabId);
      });

      document.querySelectorAll('.form-container').forEach(container => {
        container.classList.toggle('active', container.id === tabId);
      });

      const currentTabButton = document.querySelector(`.tab-button[data-tab-id="${tabId}"]`);
      document.getElementById('tabNameInput').value = currentTabButton.textContent;
    }

    function renameTab(newName) {
      const currentTabButton = document.querySelector(`.tab-button[data-tab-id="${activeTabId}"]`);
      if (currentTabButton) currentTabButton.textContent = newName || 'Unnamed Tab';
    }

    function addFormSection() {
      if (!activeTabId) return;

      const container = document.getElementById(activeTabId);

      const section = document.createElement('div');
      section.className = 'form-section';

      section.innerHTML = `
        <button class="remove-section" onclick="this.parentElement.remove()">Ã—</button>

        <label>
          Completed?<br>
          <input type="checkbox" name="completed[]">
        </label>

        <label>
          Assessment Type:
          <select name="assessmentType[]">
            <option value="Test">Test</option>
            <option value="Project">Project</option>
            <option value="Research Paper">Research Paper</option>
            <option value="Presentation">Presentation</option>
            <option value="Lab">Lab</option>
            <option value="Exam">Exam</option>
          </select>
        </label>

        <label>
          Weighting:
          <input type="number" step="any" name="weighting[]">
        </label>

        <label>
          Marks Available:
          <input type="number" step="any" name="marksAvailable[]">
        </label>

        <label>
          Your Marks:
          <input type="number" step="any" name="yourMarks[]">
        </label>
      `;

      container.appendChild(section);
    }

    function submitData() {
      const allTabs = document.querySelectorAll('.form-container');
      const result = {};

      allTabs.forEach(tab => {
        const tabId = tab.id;
        const sections = tab.querySelectorAll('.form-section');
        const assessments = [];

        sections.forEach(section => {
          const completed = section.querySelector('input[type="checkbox"]').checked;
          const type = section.querySelector('select').value;
          const weighting = parseFloat(section.querySelector('input[name="weighting[]"]').value) || 0;
          const available = parseFloat(section.querySelector('input[name="marksAvailable[]"]').value) || 0;
          const yourMarks = parseFloat(section.querySelector('input[name="yourMarks[]"]').value) || 0;

          assessments.push([completed, type, weighting, available, yourMarks]);
        });

        const tabName = document.querySelector(`.tab-button[data-tab-id="${tabId}"]`)?.textContent || tabId;
        result[tabName] = assessments;
      });

      fetch('https://server.com/WIP', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ assessments: result })
      })
      .then(response => {
        if (!response.ok) throw new Error("Network response was not ok");
        return response.json();
      })
      .then(result => {
        console.log("Success:", result);
        alert("Data submitted successfully!");
      })
      .catch(error => {
        console.error("Error submitting data:", error);
        alert("There was an error submitting the data.");
      });
    }

    // Initialize with one tab to start
    addTab();
  </script>
</body>
</html>
